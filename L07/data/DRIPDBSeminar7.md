# MongoDB: –û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å NoSQL –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

## üìã –ü–ª–∞–Ω —Å–µ–º–∏–Ω–∞—Ä–∞

### **–ë–ª–æ–∫ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å MongoDB**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
- –û–±–∑–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ MongoDB Compass / NoSQL Booster
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### **–ë–ª–æ–∫ 2 : CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏**
- **Create** - –≤—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Read** - –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- **Update** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Delete** - —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### **–ë–ª–æ–∫ 3: –ò–Ω–¥–µ–∫—Å—ã –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏**
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ—Å—Ç—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

---

## üé¨ –î–∞—Ç–∞—Å–µ—Ç: –§–∏–ª—å–º—ã MongoDB Sample

**–ò—Å—Ç–æ—á–Ω–∏–∫:** MongoDB Sample Mflix Dataset  
**–°—Å—ã–ª–∫–∞:** https://raw.githubusercontent.com/neelabalan/mongodb-sample-dataset/main/sample_mflix/movies.json

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ñ–∏–ª—å–º–∞:
```json
{
  "_id": ObjectId("573a1390f29313caabcd4135"),
  "title": "Inception",
  "year": 2010,
  "genres": ["Sci-Fi", "Thriller"],
  "runtime": 148,
  "cast": ["Leonardo DiCaprio", "Marion Cotillard"],
  "directors": ["Christopher Nolan"],
  "imdb": {
    "rating": 8.8,
    "votes": 2000000
  },
  "tomatoes": {
    "viewer": {
      "rating": 4.2,
      "numReviews": 150000
    }
  },
  "plot": "Dom Cobb is a skilled thief...",
  "countries": ["USA", "UK"],
  "released": ISODate("2010-07-16T00:00:00.000Z")
}
```

---

# üöÄ –ë–õ–û–ö 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB

### –í–∞—Ä–∏–∞–Ω—Ç A: MongoDB –≤ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å–∫ MongoDB –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker run -d \
  --name mongodb \
  -p 27017:27017 \
  -e MONGO_INITDB_ROOT_USERNAME=admin \
  -e MONGO_INITDB_ROOT_PASSWORD=secret \
  mongo:latest

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker ps

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ mongo shell
docker exec -it mongodb mongosh -u admin -p secret
```

**–°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** `mongodb://admin:secret@localhost:27017`

### –í–∞—Ä–∏–∞–Ω—Ç B: MongoDB Compass
1. –û—Ç–∫—Ä—ã—Ç—å MongoDB Compass
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É: `mongodb://admin:secret@localhost:27017`
3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: `movies_db`

### –í–∞—Ä–∏–∞–Ω—Ç C: NoSQL Booster / MongoDB Compose
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `mongodb://admin:secret@localhost:27017`
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

## –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```javascript
// –í MongoDB Shell –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
use movies_db
```

## –®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### –ß–µ—Ä–µ–∑ Compass:
1. Collections ‚Üí Create Collection ‚Üí `movies`
2. Import Data ‚Üí Select File ‚Üí movies.json
3. File Type: JSON

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É:
```bash
mongoimport --db movies_db --collection movies --file movies.json --jsonArray
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:
```javascript
db.movies.countDocuments()

db.movies.findOne()
```

---

# üìù –ë–õ–û–ö 2: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

## 2.1 CREATE - –í—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –í—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```javascript
db.movies.insertOne({
  "title": "–ú–æ–π –ª—é–±–∏–º—ã–π —Ñ–∏–ª—å–º",
  "year": 2024,
  "genres": ["–î—Ä–∞–º–∞", "–ö–æ–º–µ–¥–∏—è"],
  "directors": ["–°—Ç—É–¥–µ–Ω—Ç –ü–µ—Ä–≤—ã–π"],
  "cast": ["–ê–∫—Ç–µ—Ä –ê", "–ê–∫—Ç–µ—Ä –ë"],
  "runtime": 120,
  "imdb": {
    "rating": 9.5,
    "votes": 1000
  },
  "plot": "–ò—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç –∏–∑—É—á–∞–ª MongoDB"
})
```

### –í—Å—Ç–∞–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```javascript
db.movies.insertMany([
  {
    "title": "MongoDB: –§–∏–ª—å–º",
    "year": 2024,
    "genres": ["–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π"],
    "runtime": 90,
    "imdb": {"rating": 8.0, "votes": 500}
  },
  {
    "title": "NoSQL –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è",
    "year": 2024,
    "genres": ["–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    "runtime": 105,
    "imdb": {"rating": 7.5, "votes": 300}
  }
])
```

### üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1
**–°–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ –ª—é–±–∏–º–æ–≥–æ —Ñ–∏–ª—å–º–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏**

---

## 2.2 READ - –ß—Ç–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫
### –ë–∞–∑–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

#### –ù–∞–π—Ç–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```javascript
db.movies.find()
```

#### –ù–∞–π—Ç–∏ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
```javascript
db.movies.findOne()
```

#### –ü–æ–∏—Å–∫ —Å —É—Å–ª–æ–≤–∏–µ–º
```javascript
// –§–∏–ª—å–º—ã 2010 –≥–æ–¥–∞
db.movies.find({"year": 2010})

// –§–∏–ª—å–º—ã —Å –≤—ã—Å–æ–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
db.movies.find({"imdb.rating": {"$gte": 8.0}})
```

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

```javascript
// –†–∞–≤–µ–Ω—Å—Ç–≤–æ
db.movies.find({"year": 2010})

// –ë–æ–ª—å—à–µ —á–µ–º
db.movies.find({"year": {"$gt": 2000}})

// –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
db.movies.find({"imdb.rating": {"$gte": 8.0}})

// –ú–µ–Ω—å—à–µ —á–µ–º
db.movies.find({"runtime": {"$lt": 90}})

// –ù–µ —Ä–∞–≤–Ω–æ
db.movies.find({"year": {"$ne": 2010}})

// –í —Å–ø–∏—Å–∫–µ –∑–Ω–∞—á–µ–Ω–∏–π
db.movies.find({"year": {"$in": [2010, 2015, 2020]}})

// –ù–µ –≤ —Å–ø–∏—Å–∫–µ
db.movies.find({"year": {"$nin": [1990, 1995]}})
```

### –†–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏

```javascript
// –§–∏–ª—å–º—ã —Å –∂–∞–Ω—Ä–æ–º "Drama"
db.movies.find({"genres": "Drama"})

// –§–∏–ª—å–º—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∂–∞–Ω—Ä–∞–º–∏
db.movies.find({"genres": {"$all": ["Drama", "Romance"]}})

// –§–∏–ª—å–º—ã —Å Leonardo DiCaprio
db.movies.find({"cast": "Leonardo DiCaprio"})
```

### –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ (regex)

```javascript
// –§–∏–ª—å–º—ã, –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å "Love"
db.movies.find({"title": {"$regex": "Love", "$options": "i"}})

// –§–∏–ª—å–º—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "The"
db.movies.find({"title": {"$regex": "^The"}})
```

### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

```javascript
// –ò (AND)
db.movies.find({
  "$and": [
    {"year": {"$gte": 2000}},
    {"imdb.rating": {"$gte": 7.0}}
  ]
})

// –ò–õ–ò (OR)
db.movies.find({
  "$or": [
    {"genres": "Comedy"},
    {"genres": "Romance"}
  ]
})
```

### –ü—Ä–æ–µ–∫—Ü–∏—è (–≤—ã–±–æ—Ä –ø–æ–ª–µ–π)

```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –≥–æ–¥
db.movies.find({}, {"title": 1, "year": 1, "_id": 0})

// –ò—Å–∫–ª—é—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è
db.movies.find({}, {"plot": 0, "fullplot": 0})
```

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```javascript
// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–æ–¥—É (—É–±—ã–≤–∞–Ω–∏–µ)
db.movies.find().sort({"year": -1})

// –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç 5 –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
db.movies.find().limit(5)

// –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–µ 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
db.movies.find().skip(10)

// –ö–æ–º–±–∏–Ω–∞—Ü–∏—è
db.movies.find({"imdb.rating": {"$gte": 8.0}})
         .sort({"imdb.rating": -1})
         .limit(10)
```

### üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. **–ù–∞–π–¥–∏—Ç–µ –≤—Å–µ —Ñ–∏–ª—å–º—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º IMDB –≤—ã—à–µ 8.5**
2. **–ù–∞–π–¥–∏—Ç–µ –∫–æ–º–µ–¥–∏–∏, –≤—ã–ø—É—â–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 2000 –≥–æ–¥–∞**
3. **–ù–∞–π–¥–∏—Ç–µ —Ñ–∏–ª—å–º—ã —Å Tom Hanks –≤ –∞–∫—Ç–µ—Ä—Å–∫–æ–º —Å–æ—Å—Ç–∞–≤–µ**
4. **–ù–∞–π–¥–∏—Ç–µ —Ç–æ–ø-10 —Ñ–∏–ª—å–º–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É IMDB**
5. **–ù–∞–π–¥–∏—Ç–µ —Ñ–∏–ª—å–º—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –æ—Ç 90 –¥–æ 120 –º–∏–Ω—É—Ç**

---

## 2.3 UPDATE - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**MongoDB –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:**
```javascript
// –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ updateOne()
{
  "acknowledged": true,
  "matchedCount": 1,    // –ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  "modifiedCount": 1,   // –ò–∑–º–µ–Ω–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  "upsertedId": null    // ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–µ—Å–ª–∏ upsert)
}
```

**–í–∞–∂–Ω–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π!**

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

```javascript
// –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥
db.movies.findOne({"title": "Inception"}, {"title": 1, "imdb.rating": 1})

// –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞
db.movies.update(
  {"title": "Inception"},
  {"$set": {"imdb.rating": 9.0}}
)

// –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
db.movies.findOne({"title": "Inception"}, {"title": 1, "imdb.rating": 1})
```

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### $set - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
```javascript
// –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
db.movies.findOne({"title": "Titanic"}, {"title": 1, "imdb.rating": 1, "runtime": 1})

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
db.movies.update(
  {"title": "Titanic"},
  {"$set": {
    "imdb.rating": 7.8,
    "runtime": 195,
    "updated": new Date()
  }}
)

// –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
db.movies.findOne({"title": "Titanic"}, {"title": 1, "imdb.rating": 1, "runtime": 1, "updated": 1})
```

#### $inc - —É–≤–µ–ª–∏—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
```javascript
// –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
db.movies.findOne({"title": "The Dark Knight"}, {"title": 1, "imdb.votes": 1})

// –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤ –Ω–∞ 100
db.movies.update(
  {"title": "The Dark Knight"},
  {"$inc": {"imdb.votes": 100}}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
db.movies.findOne({"title": "The Dark Knight"}, {"title": 1, "imdb.votes": 1})
```

#### $push - –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤
```javascript
// –°–Ω–∞—á–∞–ª–∞ —Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –∂–∞–Ω—Ä—ã
db.movies.findOne({"title": "Interstellar"}, {"title": 1, "genres": 1})

// –î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä
db.movies.update(
  {"title": "Interstellar"},
  {"$push": {"genres": "Epic"}}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã
db.movies.findOne({"title": "Interstellar"}, {"title": 1, "genres": 1})

// –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ cast
db.movies.update(
  {"title": "Avatar"},
  {"$push": {"cast": {"$each": ["–ù–æ–≤—ã–π –ê–∫—Ç–µ—Ä 1", "–ù–æ–≤—ã–π –ê–∫—Ç–µ—Ä 2"]}}}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π cast
db.movies.findOne({"title": "Avatar"}, {"title": 1, "cast": 1})
```

#### $pull - —É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
```javascript
// –ù–∞–π–¥–µ–º —Ñ–∏–ª—å–º —Å –∂–∞–Ω—Ä–æ–º Horror
db.movies.findOne({"genres": "Horror"}, {"title": 1, "genres": 1})

// –£–¥–∞–ª–∏—Ç—å –∂–∞–Ω—Ä Horror –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
db.movies.update(
  {"title": "–ù–ê–ó–í–ê–ù–ò–ï_–§–ò–õ–¨–ú–ê"},
  {"$pull": {"genres": "Horror"}}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
db.movies.findOne({"title": "–ù–ê–ó–í–ê–ù–ò–ï_–§–ò–õ–¨–ú–ê"}, {"title": 1, "genres": 1})
```

#### $addToSet - –¥–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤
```javascript
// –î–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
db.movies.findOne({"genres": "Action"}, {"title": 1, "genres": 1})

// –î–æ–±–∞–≤–ª—è–µ–º –∂–∞–Ω—Ä (–Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å)
db.movies.update(
  {"genres": "Action"},
  {"$addToSet": {"genres": "Thriller"}}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
db.movies.findOne({"title": "–ù–ê–ó–í–ê–ù–ò–ï_–ù–ê–ô–î–ï–ù–ù–û–ì–û_–§–ò–õ–¨–ú–ê"}, {"title": 1, "genres": 1})
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```javascript
// –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å–º–æ–≤ 1990 –≥–æ–¥–∞ –±–µ–∑ –ø–æ–ª—è "decade"
db.movies.countDocuments({"year": 1990, "decade": {"$exists": false}})

// –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã 1990 –≥–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä multi: true)
db.movies.update(
  {"year": 1990},
  {"$set": {"decade": "90s"}},
  {"multi": true}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - —Å–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
db.movies.countDocuments({"year": 1990, "decade": "90s"})

// –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –æ–¥–∏–Ω –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
db.movies.findOne({"year": 1990}, {"title": 1, "year": 1, "decade": 1})
```

### Upsert - –≤—Å—Ç–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

```javascript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∏–ª—å–º
db.movies.findOne({"title": "–ù–æ–≤—ã–π —Ñ–∏–ª—å–º 2024"})

// Upsert –æ–ø–µ—Ä–∞—Ü–∏—è
db.movies.update(
  {"title": "–ù–æ–≤—ã–π —Ñ–∏–ª—å–º 2024"},
  {"$set": {
    "year": 2024,
    "genres": ["Sci-Fi"],
    "imdb": {"rating": 7.0}
  }},
  {"upsert": true}  // –°–æ–∑–¥–∞—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –±—ã–ª —Å–æ–∑–¥–∞–Ω
db.movies.findOne({"title": "–ù–æ–≤—ã–π —Ñ–∏–ª—å–º 2024"})

// –ü–æ–ø—Ä–æ–±—É–µ–º upsert –µ—â–µ —Ä–∞–∑ (–¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
db.movies.update(
  {"title": "–ù–æ–≤—ã–π —Ñ–∏–ª—å–º 2024"},
  {"$set": {"imdb.rating": 7.5}},
  {"upsert": true}
)

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
db.movies.findOne({"title": "–ù–æ–≤—ã–π —Ñ–∏–ª—å–º 2024"}, {"title": 1, "imdb.rating": 1})
```

### üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥ —Å–≤–æ–µ–≥–æ –ª—é–±–∏–º–æ–≥–æ —Ñ–∏–ª—å–º–∞**
   ```javascript
   // –ù–∞–π–¥–∏—Ç–µ —Ñ–∏–ª—å–º
   db.movies.findOne({"title": "–ù–ê–ó–í–ê–ù–ò–ï"}, {"title": 1, "imdb.rating": 1})
   
   // –û–±–Ω–æ–≤–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥
   db.movies.update({"title": "–ù–ê–ó–í–ê–ù–ò–ï"}, {"$set": {"imdb.rating": 9.5}})
   
   // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   db.movies.findOne({"title": "–ù–ê–ó–í–ê–ù–ò–ï"}, {"title": 1, "imdb.rating": 1})
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –∂–∞–Ω—Ä "Classic" –≤—Å–µ–º —Ñ–∏–ª—å–º–∞–º –¥–æ 1980 –≥–æ–¥–∞**
   ```javascript
   // –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
   db.movies.countDocuments({"year": {"$lt": 1980}})
   
   // –û–±–Ω–æ–≤–∏–º (–Ω–µ –∑–∞–±—ã–≤–∞–µ–º multi: true –¥–ª—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
   db.movies.update(
     {"year": {"$lt": 1980}}, 
     {"$addToSet": {"genres": "Classic"}},
     {"multi": true}
   )
   
   // –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   db.movies.findOne({"year": {"$lt": 1980}}, {"title": 1, "year": 1, "genres": 1})
   ```

3. **–£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤ –Ω–∞ 1000 –¥–ª—è —Ñ–∏–ª—å–º–æ–≤ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –≤—ã—à–µ 9.0**
   ```javascript
   // –ù–∞–π–¥–µ–º —Ñ–∏–ª—å–º—ã —Å –≤—ã—Å–æ–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
   db.movies.find({"imdb.rating": {"$gt": 9.0}}, {"title": 1, "imdb.rating": 1, "imdb.votes": 1})
   
   // –û–±–Ω–æ–≤–∏–º –≥–æ–ª–æ—Å–∞
   db.movies.update(
     {"imdb.rating": {"$gt": 9.0}}, 
     {"$inc": {"imdb.votes": 1000}},
     {"multi": true}
   )
   
   // –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   db.movies.find({"imdb.rating": {"$gt": 9.0}}, {"title": 1, "imdb.rating": 1, "imdb.votes": 1})
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ upsert –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ñ–∏–ª—å–º–∞**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Ñ–∏–ª—å–º–∞ –Ω–µ—Ç
   db.movies.findOne({"title": "–ú–æ–π —Ñ–∏–ª—å–º 2024"})
   
   // –°–æ–∑–¥–∞–¥–∏–º —á–µ—Ä–µ–∑ upsert
   db.movies.update(
     {"title": "–ú–æ–π —Ñ–∏–ª—å–º 2024"},
     {"$set": {"year": 2024, "genres": ["Drama"], "imdb": {"rating": 8.5}}},
     {"upsert": true}
   )
   
   // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å–æ–∑–¥–∞–ª—Å—è
   db.movies.findOne({"title": "–ú–æ–π —Ñ–∏–ª—å–º 2024"})
   ```

---

## 2.4 DELETE - –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

```javascript
// –£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
db.movies.deleteOne({"title": "Bad Movie"})
```

### –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```javascript
// –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –Ω–∏–∂–µ 2.0
db.movies.deleteMany({"imdb.rating": {"$lt": 2.0}})

// –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã –±–µ–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞
db.movies.deleteMany({"imdb.rating": {"$exists": false}})
```

### –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

```javascript
// –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç –í–°–ï –¥–æ–∫—É–º–µ–Ω—Ç—ã!
db.movies.deleteMany({})

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
db.movies.drop()
```

### üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
**–£–¥–∞–ª–∏—Ç–µ —Ñ–∏–ª—å–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

---

# üìä –ë–õ–û–ö 3: –ò–Ω–¥–µ–∫—Å—ã –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

## 3.1 –†–∞–±–æ—Ç–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

```javascript
// –ü—Ä–æ—Å—Ç–æ–π –∏–Ω–¥–µ–∫—Å –ø–æ –≥–æ–¥—É –≤—ã–ø—É—Å–∫–∞
db.movies.createIndex({"year": 1})

// –ò–Ω–¥–µ–∫—Å –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (—É–±—ã–≤–∞–Ω–∏–µ)
db.movies.createIndex({"imdb.rating": -1})

// –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
db.movies.createIndex({"year": 1, "imdb.rating": -1})

// –ò–Ω–¥–µ–∫—Å –ø–æ —Ç–µ–∫—Å—Ç—É (–¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö)
db.movies.createIndex({"title": "text", "plot": "text"})
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–¥–µ–∫—Å–æ–≤

```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∫–æ–ª–ª–µ–∫—Ü–∏–∏
db.movies.getIndexes()
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å explain()

```javascript
// –ó–∞–ø—Ä–æ—Å –ë–ï–ó –∏–Ω–¥–µ–∫—Å–∞ - —Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
db.movies.find({"year": 2010}).explain("executionStats")

// –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –ø–æ –≥–æ–¥—É
db.movies.createIndex({"year": 1})

// –¢–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –° –∏–Ω–¥–µ–∫—Å–æ–º
db.movies.find({"year": 2010}).explain("executionStats")
```

### üìä –ö–∞–∫ —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã explain()

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| `stage` | –≠—Ç–∞–ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`COLLSCAN` - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, `IXSCAN` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞) |
| `filter` | –£—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∫ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã |
| `docsExamined` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| `nReturned` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–º |
| `totalKeysExamined` | –°–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –∏–Ω–¥–µ–∫—Å–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ (>0 –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| `executionTimeMillis` | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö |
| `winningPlan` | –ü–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π MongoDB –≤—ã–±—Ä–∞–ª–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `rejectedPlans` | –ü–ª–∞–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ MongoDB –æ—Ç–∫–ª–æ–Ω–∏–ª–∞ |

#### –ü—Ä–∏–º–µ—Ä—ã –∞–Ω–∞–ª–∏–∑–∞:

```javascript
// üîç –ü–ª–æ—Ö–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞):
{
  "stage": "COLLSCAN",           // ‚ùå –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
  "docsExamined": 23539,         // ‚ùå –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –º–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  "nReturned": 279,              // ‚úÖ –í–µ—Ä–Ω—É–ª–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ
  "executionTimeMillis": 25      // ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ
}

// üöÄ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å –∏–Ω–¥–µ–∫—Å–æ–º):
{
  "stage": "IXSCAN",             // ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
  "docsExamined": 279,           // ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –º–∏–Ω–∏–º—É–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  "nReturned": 279,              // ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 1:1
  "totalKeysExamined": 279,      // ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∏–Ω–¥–µ–∫—Å
  "executionTimeMillis": 2       // ‚úÖ –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ
}
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∞–Ω–∞–ª–∏–∑–∞

```javascript
// 1. –ó–∞–ø—Ä–æ—Å –ø–æ –≥–æ–¥—É (–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å)
db.movies.find({"year": 2010}).explain("executionStats")

// 2. –ó–∞–ø—Ä–æ—Å –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å)
db.movies.find({"imdb.rating": {"$gte": 8.0}}).explain("executionStats")

// 3. –°–æ—Å—Ç–∞–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å)
db.movies.find({"year": 2010, "imdb.rating": {"$gte": 7.0}}).explain("executionStats")

// 4. –ó–∞–ø—Ä–æ—Å –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å COLLSCAN)
db.movies.find({"runtime": {"$gt": 120}}).explain("executionStats")
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –Ω–∞—à–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞:

```javascript
// –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
db.movies.createIndex({"year": 1})
db.movies.createIndex({"imdb.rating": -1})
db.movies.createIndex({"genres": 1})
db.movies.createIndex({"year": 1, "imdb.rating": -1})
```

## 3.2 –ü—Ä–æ—Å—Ç—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

### –ü–æ–¥—Å—á–µ—Ç —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä–∞–º

```javascript
// –ü—Ä–æ—Å—Ç–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: —Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å–º–æ–≤ –∫–∞–∂–¥–æ–≥–æ –∂–∞–Ω—Ä–∞
db.movies.aggregate([
  {"$unwind": "$genres"},           // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ –∂–∞–Ω—Ä–æ–≤
  {"$group": {                      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∂–∞–Ω—Ä–∞–º
    "_id": "$genres",
    "–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ": {"$sum": 1}       // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  }},
  {"$sort": {"–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ": -1}},    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
  {"$limit": 5}                     // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-5
])
```

### –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –≥–æ–¥–∞–º

```javascript
// –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ IMDB –ø–æ –≥–æ–¥–∞–º
db.movies.aggregate([
  {"$group": {
    "_id": "$year",                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –≥–æ–¥–∞–º
    "—Å—Ä–µ–¥–Ω–∏–π_—Ä–µ–π—Ç–∏–Ω–≥": {"$avg": "$imdb.rating"},
    "–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Ñ–∏–ª—å–º–æ–≤": {"$sum": 1}
  }},
  {"$sort": {"_id": -1}},            // –û—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º –≥–æ–¥–∞–º
  {"$limit": 10}
])
```

### –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–∫—Ç–µ—Ä—ã

```javascript
// –ü–æ–¥—Å—á–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å–º–æ–≤ —É –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–µ—Ä–∞
db.movies.aggregate([
  {"$unwind": "$cast"},              // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ –∞–∫—Ç–µ—Ä–æ–≤
  {"$group": {
    "_id": "$cast",                  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∞–∫—Ç–µ—Ä–∞–º
    "—Ñ–∏–ª—å–º–æ–≤": {"$sum": 1}
  }},
  {"$sort": {"—Ñ–∏–ª—å–º–æ–≤": -1}},        // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  {"$limit": 10}
])
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```javascript
// –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å–º–æ–≤
db.movies.aggregate([
  {"$group": {
    "_id": null,                     // –û–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –¥–ª—è –≤—Å–µ—Ö
    "—Å—Ä–µ–¥–Ω—è—è_–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å": {"$avg": "$runtime"},
    "–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è": {"$max": "$runtime"},
    "–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è": {"$min": "$runtime"},
    "–≤—Å–µ–≥–æ_—Ñ–∏–ª—å–º–æ–≤": {"$sum": 1}
  }}
])
```

---

# üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–í–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `shop` –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ BSON (Binary JSON).

**–ö–æ–ª–ª–µ–∫—Ü–∏—è `products` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤:**
```javascript
{
  name: "iPhone 15",
  price: 80000,
  quantity: 10,
  description: "–ù–æ–≤—ã–π iPhone —Å —á–∏–ø–æ–º A17 Pro"
}
```

–ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º —Å–æ –≤—Å–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ü–æ–ª–µ `name` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, `price` ‚Äî —Ü–µ–Ω—É –≤ —Ä—É–±–ª—è—Ö, `quantity` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ, –∞ `description` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ. MongoDB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ `_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**–ö–æ–ª–ª–µ–∫—Ü–∏—è `orders` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤:**
```javascript
{
  customer_email: "ivan@mail.ru",
  product_name: "iPhone 15",
  quantity: 2,
  total_price: 160000,
  order_date: new Date("2024-12-15")
}
```

–ö–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ç–æ–≤–∞—Ä–æ–º —á–µ—Ä–µ–∑ email –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞. –ü–æ–ª–µ `quantity` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞ –≤ –∑–∞–∫–∞–∑–µ, `total_price` ‚Äî –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏, –∞ `order_date` ‚Äî –¥–∞—Ç—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞. –¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–æ–¥–∞–∂–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

## –ó–∞–¥–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –¥–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.**

2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –¥–æ—Ä–æ–∂–µ 50000 —Ä—É–±–ª–µ–π
   - –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
   - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º 0

3. **–ù–∞–ø–∏—à–∏—Ç–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
   - –ü–æ–¥—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –ù–∞–π–¥–∏—Ç–µ —Ç–æ–ø-3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–∞ —Å –∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
   - –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ (—Ü–µ–Ω–∞ √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
   - –ù–∞–π–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≥–¥–µ —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ –±–æ–ª—å—à–µ 30000 —Ä—É–±–ª–µ–π
   - –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
   - –ü–æ—Å—á–∏—Ç–∞—Ç—Å —Å—É–º–º—É –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ customer_email –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ–±—â–µ–π —Å—É–º–º—ã
   - –ù–∞–π—Ç–∏ —Ç–æ–ø-3 —Å–∞–º—ã—Ö –ø—Ä–æ–¥–∞–≤–∞–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

